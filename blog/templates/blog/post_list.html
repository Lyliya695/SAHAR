{% extends 'base.html' %}
{% load static %}
<!-- новое -->
{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/swiper-bundle.min.css' %}">
<!-- <link rel="stylesheet" href="{% static 'blog/css/swiper.css' %}"> -->
<style>
    .swiper {
        width: 100%;
        height: 400px;
        margin: 30px 0;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
    }
    
    .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: none;
    }

   .swiper-slide {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .slide-content {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.7));
        color: white;
        padding: 30px 20px 20px;
        z-index: 2;
    }

    .slide-content h3 {
        margin: 0 0 10px 0;
        font-size: 1.5rem;
    }

    .slide-content p {
        margin: 0;
        font-size: 1rem;
        opacity: 0.9;
    }

    .swiper-button-next,
    .swiper-button-prev {
        color: white;
        background: rgba(0,0,0,0.3);
        width: 44px;
        height: 44px;
        border-radius: 50%;
        backdrop-filter: blur(4px);
    }

    .swiper-button-next:after,
    .swiper-button-prev:after {
        font-size: 1.2rem;
    }

    .swiper-pagination-bullet {
        background: white;
        opacity: 0.5;
    }

    .swiper-pagination-bullet-active {
        opacity: 1;
    }

    
    @media (max-width: 768px) {
        .swiper {
            height: 300px;
        }
        
        .slide-content {
            padding: 20px 15px 15px;
        }
        
        .slide-content h3 {
            font-size: 1.2rem;
        }
    } 
</style>
{% endblock %}

{% block seo %}
<meta name="title" content="Название компании - Посты">
<meta name="description" content="Личный блог о Django, Python и веб-разработке. Статьи, заметки и практические примеры.">
<meta name="keywords" content="django, python, блог, веб-разработка">
<meta property="og:title" content="Веб-студия Mates | Разработка сайтов во Владикавказе под ключ">
<meta property="og:description" content="Веб-студия Mates | Разработка сайтов во Владикавказе под ключ">
<meta property="og:image" content="https://mates-web.ru/images/logo.png">
<!-- open graph -->
{% endblock %}
{% block content %}



{% if slides %}
<div class="swiper banner">
    <div class="swiper-wrapper">
        {% for slide in slides %}
        <div class="swiper-slide">
            {% if slide.link %}
            <a href="{{ slide.link }}">
            {% endif %}
                <img src="{{ slide.image.url }}" alt="{{ slide.title }}">
                <div class="slide-content">
                    {% if slide.show_title %}
                    <h3>{{ slide.title }}</h3>
                    {% endif %}
                    
                    {% if slide.description %}
                    <p>{{ slide.description }}</p>
                    {% endif %}
                </div>
            {% if slide.link %}
            </a>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-pagination"></div>
</div>

{% endif %}
<h1>Все посты блога</h1>
<form method="get" class="form-search">
    <input class="search" type="text" placeholder="Поиск по постам..." name="q" value="{{request.GET.q}}">
    <button type="submit">Искать</button>
    <a href="{% url 'blog:post_list' %}">Сбросить</a>
</form>
{% if posts %}
    {% for post in posts %}
        <div style="border: 1px solid #ccc; padding: 15px; margin: 20px 0;">
            <h2><a href="{% url 'blog:post_detail' post.slug %}">{{ post.title }}</a></h2>
            
            {% if post.image %}
                <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width: 300px;">
            {% endif %}
            
            <p><strong>Автор:</strong> {{ post.author.username }}</p>
            <p><strong>Дата:</strong> {{ post.created|date:"d.m.Y H:i" }}</p>
            
            <!-- 
            было
            <p>{{ post.body|truncatewords:30 }}</p> -->
            <!-- надо -->
  <!-- {{ post.body|safe|truncatewords:30 }} -->
 {{ post.excerpt }}
    <a href="{% url 'blog:post_detail' post.slug %}">Читать далее</a>
        </div>
    {% endfor %}
{% else %}
    <p>Нет постов</p>
{% endif %}


{% if page_obj.has_other_pages %}
<nav class="pagination">
<!-- Это Django Template Language (DTL) — шаблонный язык Django. -->
    {# Предыдущая страница #}
    {% if page_obj.has_previous %}
    <!-- http://127.0.0.1:8000/?page=1 -->
     <!-- http://127.0.0.1:8000/?q=Привет -->
      <!-- TODO: если постов много то отображать не все страницы
       а ставить между ними ... и номер последней как
        на других сайтах -->
<a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">
    ← Назад
</a>
    {% endif %}
    <!-- for i in range(1,10) -->
    {% for page in page_obj.paginator.page_range %}
        {% if page == page_obj.number %}
            <span class="current">{{ page }}</span>
        {% else %}
    <a href="?page={{ page }}{% if query %}&q={{ query }}{% endif %}">
                {{ page }}
            </a>
        {% endif %}
    {% endfor %}
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}">
        Вперёд →
        </a>
    {% endif %}
</nav>
{% endif %}
{% endblock %}

{% block extra_js %}
<!-- Подключаем Swiper JS -->
<script src="{% static 'blog/js/swiper-bundle.min.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const swiper = new Swiper('.swiper', {
            loop: true, //бесконечный если true
            speed: 600, // чем больше число, тем плавнее слайды меняются
            autoplay: { //включаем автопрокрутку
                delay: 5000,
                // 5 секунд - перерыв
                disableOnInteraction: false,
                // если пользователь нажал на стрелку - не отключаем автопрокрутку
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true, // можно листать слайды с ее помощью
            }, 
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            effect: 'fade', // slide - стандартный, coverflow - 3д-эффект
            fadeEffect: {
                crossFade: true // одновременно затухает старый и появляется новый
                // если false, то старый сначала исчезает
            },
            breakpoints: {
                320: {
                    slidesPerView: 1,
                    spaceBetween: 10
                },
                768: {
                    slidesPerView: 1,
                    spaceBetween: 20
                },
            }
        });
    });
</script>
{% endblock %}